<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Meta tags  -->
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport"
    content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />

  <title>Speedlink</title>
  <link rel="icon" type="image/png" href="../images/favicon.png" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

  <!-- CSS Assets -->
  <link rel="stylesheet" href="../css/output.css" />
  <link rel="stylesheet" href="../css/app.css" />



  <!-- Javascript Assets -->
  <script src="https://cdn.jsdelivr.net/npm/localstorage-slim"></script>
  <script src="../js/app.js" defer></script>
  <script src="../js/jquery.js"></script>
  <script src="../js/w3.js"></script>
  <script src="https://unpkg.com/vue@3.0.11/dist/vue.global.js"></script>
  
  <script src="../js/vueStart.js"></script>


  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
    rel="stylesheet" />
</head>
<!-- <style>
    .card{
      color: black!important;
    }
    body{
      color: black!important;
    }
  </style> -->

<body x-data class="is-header-blur" x-bind="$store.global.documentBody">
  <!-- App preloader-->
  <div class="app-preloader fixed z-50 grid h-full w-full place-content-center bg-slate-50 dark:bg-navy-900">
    <div class="app-preloader-inner relative inline-block h-48 w-48"></div>
  </div>

  <!-- Page Wrapper -->
  <div id="root" class="min-h-100vh flex grow bg-slate-50 dark:bg-navy-900" x-cloak>


  <!-- App Header Wrapper-->
  <nav class="header dark:bg-slate-500">
    <div class="header-container grid grid-cols-5 w-full  px-2">
      <div class=" col-span-1 text-left  md:pl-10 flex items-center">LOGO</div>
      <div class=" col-span-4 flex tab:gap-2 gap-7 md:10 items-center px-2">
        <div
          class=" feature rounded-xl  w-fit px-2 py-2 hover:bg-slate-300/20 focus:bg-slate-300/20 active:bg-slate-300/25 dark:hover:bg-navy-300/20">
          <a >How it works</a>
          
        </div>

        <div
       
          class=" rounded-xl w-fit px-2 py-2 hover:bg-slate-300/20 focus:bg-slate-300/20 active:bg-slate-300/25 dark:hover:bg-navy-300/20">
          <a>Pricing</a>
        </div>
      </div>
    </div>

  </nav>

    <!-- Main Content Wrapper -->
    <main id="create" class="main-content w-full pb-8 relative">

      <div class="w-full h-fit p-4 text-center relative top-4 text-3xl ">
        <h2>Create a new uploader </h2>
      </div>

      <div class="flex w-full h-fit p-4 items-center justify-center dark:text-white relative top-7 text-base space-x-9">
        <div class="p-2 px-5 border-b-4 hover:border-b-4 hover:border-green-600  hover:text-green-300">
          <button onclick="w3.hide('.settings, .form'), w3.show('.general')">
            General
          </button>
        </div>

        <div class="p-2 px-5 hover:border-b-4 hover:border-green-600 hover:text-green-300">
          <button onclick="w3.hide('.form, .general'), w3.show('.settings')">
            Settings
          </button>
        </div>

        <div class="p-2 px-5 hover:border-b-4 hover:border-green-600 hover:text-green-300">
          <button onclick="w3.hide('.settings, .general'), w3.show('.form')">
            Form
          </button>
        </div>

      </div>


      <div class="flex w-full h-fit p-4 items-center justify-center relative top-7 text-base space-x-9">
        <div class="grid">
          <div class="">

            <section class="card p-4 sm:p-5 w-[350px] sm:w-[400px] md:!w-[500px] lg:!w-[800px] text-sm general"
              style="display:block;">
              <div class="mt-4 space-y-4">
                <label class="block">
                  <span>Title</span>
                  <span class="relative mt-1.5 flex">
                    <input
                      class="form-input peer w-full rounded-lg border border-slate-300 bg-transparent px-3 py-2 pl-9 placeholder:text-slate-400/70 hover:border-slate-400 focus:border-primary dark:border-navy-450 dark:hover:border-navy-400 dark:focus:border-accent"
                      placeholder="Name of the form" type="text" id="create_name" />
                    <span
                      class="pointer-events-none absolute flex h-full w-10 items-center justify-center text-slate-400 peer-focus:text-primary dark:text-navy-300 dark:peer-focus:text-accent">
                      <i class="fa-regular fa-building text-base"></i>
                    </span>
                  </span>
                </label>

                <label class="block">
                  <span>Description</span>
                  <textarea rows="4" placeholder="Description of the uploader" id="create_description"
                    class="form-textarea mt-1.5 w-full rounded-lg border border-slate-300 bg-transparent p-2.5 placeholder:text-slate-400/70 hover:border-slate-400 focus:border-primary dark:border-navy-450 dark:hover:border-navy-400 dark:focus:border-accent"></textarea>
                </label>

                <label class="block">
                  <span>Destination Folder</span>
                  <span class="relative mt-1.5 flex">
                    <input
                      class="form-input peer w-full hidden rounded-lg border border-slate-300 bg-transparent px-3 py-2 pl-9 placeholder:text-slate-400/70 hover:border-slate-400 focus:border-primary dark:border-navy-450 dark:hover:border-navy-400 dark:focus:border-accent"
                      placeholder="select" id="select_folder" value="testing" type="text" />
                    <input
                      class="form-input peer w-full rounded-lg border border-slate-300 bg-transparent px-3 py-2 pl-9 placeholder:text-slate-400/70 hover:border-slate-400 focus:border-primary dark:border-navy-450 dark:hover:border-navy-400 dark:focus:border-accent"
                      placeholder="Speedlink" value="Speedlink" type="text" id="create_folder" />
                    <input
                    id="file_res"
                      class="form-input peer w-full rounded-lg border border-slate-300 bg-transparent px-3 py-2 pl-9 placeholder:text-slate-400/70 hover:border-slate-400 focus:border-primary dark:border-navy-450 dark:hover:border-navy-400 dark:focus:border-accent"
                      placeholder="" value="Speedlink" type="text" />
                    <span
                      class="pointer-events-none absolute flex h-full w-10 items-center justify-center text-slate-400 peer-focus:text-primary dark:text-navy-300 dark:peer-focus:text-accent">
                      <i class="fa-regular fa-building text-base"></i>
                    </span>
                    <button id="" onclick="handleAuthClick()"
                      class="btn ml-2 space-x-2 bg-primary font-medium text-white hover:bg-primary-focus focus:bg-primary-focus active:bg-primary-focus/90 dark:bg-accent dark:hover:bg-accent-focus dark:focus:bg-accent-focus dark:active:bg-accent/90">
                      <span>Select</span>
                      <i class="bi bi-google"></i>
                    </button>
                  </span>
                </label>

                <label class="block addQuestion_" onclick="w3.hide('.settings, .general'), w3.show('.form')" style="display: block;">
                  <div class=" btn border border-primary/30 bg-primary/10 font-medium text-primary hover:bg-primary/20 focus:bg-primary/20 active:bg-primary/25 dark:border-accent-light/30 dark:bg-accent-light/10 dark:text-accent-light dark:hover:bg-accent-light/20 dark:focus:bg-accent-light/20 dark:active:bg-accent-light/25 w-[50%] text-center">
                    Add Questions Form
                  </div>
                </label>

                <label class="block questionAdded_" style="display: none;">
                  <div class="border rounded-lg btn border-success/30 dark:border-success/30 hover:bg-success/20 bg-success/10 text-success px-3 py-2  w-[50%] text-center">
                    Questions Added Successfully
                  </div>
                </label>

                <div class="flex justify-start space-x-2">

                  <button id="create_save"
                    class="btn space-x-2 bg-primary font-medium text-white hover:bg-primary-focus focus:bg-primary-focus active:bg-primary-focus/90 dark:bg-accent dark:hover:bg-accent-focus dark:focus:bg-accent-focus dark:active:bg-accent/90">
                    <span>Create</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewbox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd"
                        d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z"
                        clip-rule="evenodd" />
                    </svg>
                  </button>
                </div>
                <div class="file_res">
                  
                </div>
              </div>
            </section>

            <section class="card p-4 sm:p-5 w-full sm:w-[400px] md:!w-[500px] lg:!w-[800px] text-sm settings"
              style="display:none;">
              <div x-data="{askForName:true, sendNotification: true}">
                <div class="p-2">
                  <label class="inline-flex items-center space-x-2">
                    <input
                      class="form-checkbox is-basic h-5 w-5 rounded bg-slate-100 border-slate-400/70 checked:bg-primary checked:border-primary hover:border-primary focus:border-primary dark:bg-navy-900 dark:border-navy-500 dark:checked:bg-accent dark:checked:border-accent dark:hover:border-accent dark:focus:border-accent"
                      type="checkbox" name="ask" x-model="askForName" value="false" checked />
                    <p>Ask for name and email before upload</p>
                  </label>
                </div>
                <div class="p-2">
                  <label class="inline-flex items-center space-x-2">
                    <input
                      class="form-checkbox is-basic h-5 w-5 rounded bg-slate-100 border-slate-400/70 checked:bg-primary checked:border-primary hover:border-primary focus:border-primary dark:bg-navy-900 dark:border-navy-500 dark:checked:bg-accent dark:checked:border-accent dark:hover:border-accent dark:focus:border-accent"
                      type="checkbox" name="send" x-model="sendNotification" value="false" checked />
                    <p>Send me a notification after upload</p>
                  </label>
                </div>
                <p id="askForName" x-text="askForName" class="hidden"></p>
                <p id="sendNotification" x-text="sendNotification" class="hidden"></p>
              </div>
              <br>
              <br>

              <div class="grid grid-cols-12 gap-4 mt-4 text-sm">

                <!-- START GRID -->
                <div class="col-span-12 sm:col-span-4 p-2 " x-data="{quantity: ['multiple_files']}">
                  <h3 class="pb-4 font-bold">Quantity</h3>
                  <div>
                    <label class="inline-flex items-center space-x-2">
                      <input
                        class="form-radio is-outline h-5 w-5 rounded-full border-slate-400/70 bg-slate-100 before:bg-primary checked:border-primary hover:border-primary focus:border-primary dark:border-navy-500 dark:bg-navy-900 dark:before:bg-accent dark:checked:border-accent dark:hover:border-accent dark:focus:border-accent"
                        name="quantity" type="radio" name="quantity" x-model="quantity" value="multiple_files"
                        checked />
                      <p>Multiple files</p>
                    </label>
                  </div>

                  <div>
                    <label class="inline-flex items-center space-x-2">
                      <input
                        class="form-radio is-outline h-5 w-5 rounded-full border-slate-400/70 bg-slate-100 before:bg-primary checked:border-primary hover:border-primary focus:border-primary dark:border-navy-500 dark:bg-navy-900 dark:before:bg-accent dark:checked:border-accent dark:hover:border-accent dark:focus:border-accent"
                        name="quantity" type="radio" name="quantity" x-model="quantity" value="one_file" />
                      <p>One file at time</p>
                    </label>
                  </div>
                  <p id="quantity" x-text="quantity" class="hidden"></p>
                </div>

                <!-- NEXT GRID -->
                <div class="col-span-12 sm:col-span-4 p-2 " x-data="{file_type: ['any_exe']}">
                  <h3 class="pb-4 font-bold">File types </h3>
                  <div>
                    <label class="inline-flex items-center space-x-2">
                      <input
                        class="form-radio is-outline h-5 w-5 rounded-full border-slate-400/70 bg-slate-100 before:bg-primary checked:border-primary hover:border-primary focus:border-primary dark:border-navy-500 dark:bg-navy-900 dark:before:bg-accent dark:checked:border-accent dark:hover:border-accent dark:focus:border-accent"
                        name="file_type" type="radio" name="file_type" value="any_exe" x-model="file_type" checked />
                      <p>Any file extension</p>
                    </label>
                  </div>

                  <div>
                    <label class="inline-flex items-center space-x-2">
                      <input
                        class="form-radio is-outline h-5 w-5 rounded-full border-slate-400/70 bg-slate-100 before:bg-primary checked:border-primary hover:border-primary focus:border-primary dark:border-navy-500 dark:bg-navy-900 dark:before:bg-accent dark:checked:border-accent dark:hover:border-accent dark:focus:border-accent"
                        name="file_type" type="radio" name="file_type" value="image_only_exe" x-model="file_type" />
                      <p>Images only (jpg, jpeg, png, gif)</p>
                    </label>
                  </div>

                  <div>
                    <label class="inline-flex items-center space-x-2">
                      <input
                        class="form-radio is-outline h-5 w-5 rounded-full border-slate-400/70 bg-slate-100 before:bg-primary checked:border-primary hover:border-primary focus:border-primary dark:border-navy-500 dark:bg-navy-900 dark:before:bg-accent dark:checked:border-accent dark:hover:border-accent dark:focus:border-accent"
                        name="file_type" type="radio" name="file_type" value="document_exe" x-model="file_type" />
                      <p>Documents (doc, docx, xls, xlsx, pdf, odt, ods)</p>
                    </label>
                  </div>

                  <div x-data="{open:false, debounceText:''}">
                    <label class="inline-flex items-center space-x-2">
                      <input @click="open=!open"
                        class="form-radio is-outline h-5 w-5 rounded-full border-slate-400/70 bg-slate-100 before:bg-primary checked:border-primary hover:border-primary focus:border-primary dark:border-navy-500 dark:bg-navy-900 dark:before:bg-accent dark:checked:border-accent dark:hover:border-accent dark:focus:border-accent"
                        name="file_type" type="radio" name="file_type" value="custom_exe" x-model="file_type" />
                      <p>Custom list</p>
                    </label>

                    <label class="block mt-2" @click.away="open=false" x-show="open">
                      <span>Enter Tags:</span>
                      <input x-model.debounce="debounceText" class="mt-1.5 w-full" id="custom_list" x-init="$el._tom = new Tom($el,{
                                    plugins: ['remove_button'],
                                    create: true,
                                    onItemRemove: function (val) {
                                      $notification({text:`${val} removed`})
                                    }
                                  })" placeholder="Enter tags" type="text" />
                    </label>
                    <p x-text="debounceText" id="debounceText" class=""></p>
                  </div>

                  <p x-text="file_type" id="file_type" class="hidden"></p>
                </div>

                <!-- NEXT GRID -->
                <div class="col-span-12 sm:col-span-4 p-2 " x-data="{uploadSize: ['any_size']}">
                  <h3 class="pb-4 font-bold">Upload size</h3>
                  <div>
                    <label class="inline-flex items-center space-x-2">
                      <input x-model="uploadSize" value="any_size"
                        class="form-radio is-outline h-5 w-5 rounded-full border-slate-400/70 bg-slate-100 before:bg-primary checked:border-primary hover:border-primary focus:border-primary dark:border-navy-500 dark:bg-navy-900 dark:before:bg-accent dark:checked:border-accent dark:hover:border-accent dark:focus:border-accent"
                        name="outline_filled" type="radio" name="upload_size" />
                      <p>Any size</p>
                    </label>
                  </div>

                  <div x-data="{open:false}">
                    <label class="inline-flex items-center space-x-2">
                      <input x-model="uploadSize" @click="open=!open" value="less_than"
                        class="form-radio is-outline h-5 w-5 rounded-full border-slate-400/70 bg-slate-100 before:bg-primary checked:border-primary hover:border-primary focus:border-primary dark:border-navy-500 dark:bg-navy-900 dark:before:bg-accent dark:checked:border-accent dark:hover:border-accent dark:focus:border-accent"
                        name="outline_filled" type="radio" name="upload_size" checked />
                      <p>Less than</p>
                    </label>

                    <label class="mt-2 flex -space-x-px" @click.away="open=false" x-show="open">
                      <input
                        class="form-input w-full border rounded-l-lg border-slate-300 bg-transparent px-3 py-2 placeholder:text-slate-400/70 hover:z-10 hover:border-slate-400 focus:z-10 focus:border-primary dark:border-navy-450 dark:hover:border-navy-400 dark:focus:border-accent"
                        placeholder="Enter max upload size" id="actual_size" type="tel" />
                      <div
                        class="flex items-center justify-center rounded-r-lg border border-slate-300 bg-slate-150 px-3.5 font-inter text-slate-800 dark:border-navy-450 dark:bg-navy-500 dark:text-navy-100">
                        <span>MB</span>
                      </div>
                    </label>

                  </div>
                  <p x-text="uploadSize" class="hidden" id="uploadSize" class=""></p>
                </div>


              </div>

              <!-- BUTTON -->
              <div class="w-full mt-5 grid place-items-center">
                <button 
                  onclick="w3.hide('.settings, .form'), w3.show('.general')"
                  class="relative btn space-x-2 bg-primary font-medium text-white hover:bg-primary-focus focus:bg-primary-focus active:bg-primary-focus/90 dark:bg-accent dark:hover:bg-accent-focus dark:focus:bg-accent-focus dark:active:bg-accent/90">
                  <span>Save</span>
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewbox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                      d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z"
                      clip-rule="evenodd" />
                  </svg>
                </button>
              </div>
            </section>


            <!-- FORM SECTION modified with vue.js-->
            <script src="../components/createComponents/formBuilder.js"></script>
            <section class="card p-4 sm:p-5 w-full sm:w-[400px] md:!w-[500px] lg:!w-[800px] form" style="display:none;">
              <div id="form_text">You need to upgrade your plan to use the form builder. Learn more about creating the forms.</div>
              <form-builder></form-builder>
            </section>


          </div>

        </div>
      </div>




    </main>
  </div>
  <!-- 
        This is a place for Alpine.js Teleport feature 
        @see https://alpinejs.dev/directives/teleport
      -->
  <div id="x-teleport-target"></div>
  <script>
    window.addEventListener("DOMContentLoaded", () => Alpine.start());
  </script>
</body>

</html>
<script>
  const mountedApp = app.mount('#create')
</script>

<script src="../js/loading.js"></script>

<script>
  $(document).ready(function () {
    function checkForm(){
      // Toggle to display form indicator of created form
      if(localStorage.getItem('form-questions') == null){
        $('.addQuestion_').show()
        $('.questionAdded_').hide()
      }else{
        $('.questionAdded_').show()
        $('.addQuestion_').hide()
      }
    }
    checkForm()
    // check checkform() to see if questions were added
    setInterval(function(){
      checkForm()
    }, 2000)

    // Get all input data, to send to backend for processing
    $("#create_save").click(async function (e) {
      localStorage.setItem('drive_email', 'drrowly99@gmail.com');
      // We need to get select folder from the user select option else
      // We run the query to use the pre determined folder "SPEEDLINK"
      let selectFolder = '';
      let formQuestion = '';


      if($('#select_folder').val() == null){
        selectFolder = $('#create_folder').val()
      }else{
        selectFolder = $('#select_folder').val()
      }

      //condition to get form questions
      if(localStorage.getItem('form-questions') !== null){
        formQuestion = localStorage.getItem('form-questions')
      }else{
        formQuestion = null
      }
 
      
      let settings = {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${localStorage.getItem('access')}`,
          "Content-Type": "application/json; charset=UTF-8"
        },
        body: JSON.stringify({
          name: $('#create_name').val(),
          description: $('#create_description').val(),
          folder: $('#create_folder').val(),
          subfolder: $('#create_folder').val(),
          folder_id: $('#create_folder_id').val(),
          drive_email: localStorage.getItem('drive_email'),
          quantity: $('#quantity').text(),
          file_type: $('#file_type').text(),
          custom_type: $('#custom_list').val(),
          askForName: $('#askForName').text(),
          sendNotification: $('#sendNotification').text(),
          uploadSize: $('#uploadSize').text(),
          formQuestion: formQuestion

        })
      };

      console.log(settings.body)
      const myButton = document.getElementById('create_save');
      try {
        let fetchResponses = await fetch(`${backendUrl}/api/app/create`, settings);
        let stta = await fetchResponses.status
        let json = await fetchResponses.json();


        if (json.status == 200) {
          window.location.href = `${baseUel}/dash/share`;
          console.log(json.id)
          localStorage.setItem('upload_id', json.id)

        } else {
          console.log('Going to Login')
        }
      } catch (e) {
        console.log(e);
      }finally {
        setTimeout(function () {
         end_loading(myButton)
        }, 1000)
      }
    })
  }) 
</script>
<script>
  //UNSET FORM
  // alert(localStorage.setItem('form-questions'))
  if (localStorage.getItem('my_goog_acc') == null) {

  }
</script>






<script src="../js/selectFolder.js"></script>
<script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
<script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
<script src="../js/module/global.js"></script>
<script src="../js/checktoken.js"></script>